<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="shortcut icon" href="favicon.ico" />
        <link rel="stylesheet" href="css/bootstrap.min.css" />
        <link rel="stylesheet" href="css/bootstrap-theme.min.css" />
        <link rel="stylesheet" href="css/pad.css">
        <link rel="stylesheet" href="css/slider.css">
    </head>
    <body>

        <div class="navbar navbar-inverse navbar-fixed-top">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="glyphicon glyphicon-chevron-down text-info" aria-hidden="true"></span>
                    </button>
                    <a href="index.html" class="navbar-brand">
                        <span class="glyphicon glyphicon-headphones text-info" aria-hidden="true"></span>
                        Internet Radio
                    </a>

                </div>
                <div class="navbar-collapse collapse">
                    <ul class="nav navbar-nav">
                        <li><a href="index.html"><span class="glyphicon glyphicon-play text-success" aria-hidden="true"></span> Player</a></li>
                    </ul>
                     <ul class="nav navbar-nav">
                        <li><a href="doc.html"><span class="glyphicon glyphicon-education text-success" aria-hidden="true"></span> API</a></li>
                    </ul>
                    <ul class="nav navbar-nav hidden-xs">
                        <li><a href="index.html" onclick="window.open(this.href,'targetWindow','width=340,height=520,toolbar=0,location=0,status=0,menubar=0,scrollbars=0'); return false;">
			  <span class="glyphicon glyphicon-modal-window text-success" aria-hidden="true"></span> Popout
                        </a></li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container body-content">

            <div class="row text-center">
                <div class="col-md-4 col-md-offset-4">
                    <input type="text" id="number" class="input-lg btn-primary input-medium text-center" readonly="readonly" onfocus="this.blur()" />
                </div>
            </div>

            <div class="row text-center">
                <div class="col-md-4 col-md-offset-4">

                    <div class="form-group">
                        <label for="stationlist">Predefined Stations</label>
                        <select class="form-control" id="stationlist" onChange='$("#manualstation").val("");' >
                          <option value="http://bbcmedia.ic.llnwd.net/stream/bbcmedia_radio1_mf_p">Radio 1</option>
			  <option value="http://bbcmedia.ic.llnwd.net/stream/bbcmedia_radio1xtra_mf_p">Radio 1 Xtra</option>
			  <option value="http://bbcmedia.ic.llnwd.net/stream/bbcmedia_radio2_mf_p">Radio 2</option>
			  <option value="http://bbcmedia.ic.llnwd.net/stream/bbcmedia_radio3_mf_p">Radio 3</option>
			  <option value="http://bbcmedia.ic.llnwd.net/stream/bbcmedia_radio4fm_mf_p">Radio 4 FM</option>
			  <option value="http://bbcmedia.ic.llnwd.net/stream/bbcmedia_radio4lw_mf_p">Radio 4 LW</option>
			  <option value="http://bbcmedia.ic.llnwd.net/stream/bbcmedia_radio4extra_mf_p">Radio 4 Extra</option>
			  <option value="http://bbcmedia.ic.llnwd.net/stream/bbcmedia_radio5live_mf_p">Radio 5 Live</option>
			  <option value="http://bbcmedia.ic.llnwd.net/stream/bbcmedia_6music_mf_p">6Music</option>
			  <option value="http://direct.fipradio.fr/live/fip-midfi.mp3">Fip</option>
                        </select>
                    </div>
                    <div class="input-group">
                      <span class="input-group-addon" id="url-addon">Other</span>
		      <input type="text" class="form-control" id="manualstation" name="streamurl" aria-describedby="url-addon">
		      <span class="input-group-addon id="other-clear">URL</span>
		    </div>
                </div>
            </div>

            <div>&nbsp;</div>

            <div class="row text-center">
                <div class="col-md-4 col-md-offset-4">
                    <button class="btn btn-lg btn-pad btn-pad-cnt" type="button" id="stp">
                        <span class="glyphicon glyphicon-stop glyph-huge" aria-hidden="true"></span>
                    </button>

                    <button class="btn btn-lg btn-pad btn-pad-cnt" type="button" id="blank">
                    </button>

                    <button class="btn btn-lg btn-pad btn-pad-cnt" type="button" id="ply">
                        <span class="glyphicon glyphicon-play glyph-huge" aria-hidden="true"></span>
                    </button>
                </div>
            </div>

            <div class="row text-center">
                <div class="col-md-4 col-md-offset-4">
                    <button class="btn btn-lg btn-pad btn-pad-cnt" type="button" id="dn">
                        <span class="glyphicon glyphicon-volume-down glyph-huge" aria-hidden="true"></span>
                    </button>
                    <button class="btn btn-lg btn-pad" type="button" id="mute">
                        <span class="glyphicon glyphicon-volume-off glyph-huge" aria-hidden="true"></span>
                    </button>
                    <button class="btn btn-lg btn-pad btn-pad-cnt" type="button" id="up">
                        <span class="glyphicon glyphicon-volume-up glyph-huge" aria-hidden="true"></span>
                    </button>
                </div>

                <div class="row text-center">
		  <div class="col-md-4 col-md-offset-4">
		    <label for="slider">Volume</label><br/>
		    <div id="slider" style="width:260px" >&nbsp;</div>
		  </div>
		</div>

                <div class="col-md-4 col-md-offset-4">
                    <div id="debug" class="text-muted">&nbsp;</div>
                </div>
            </div>

        </div>


<!-- Bootstrap core JavaScript
 ================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="js/jquery-2-1-0-min.js"></script>
<script src="js/bootstrap.min.js"></script>
<!-- IE10 viewport hack for surface/desktop Windows 8 bug -->
<script src="js/ie10-viewport-bug-workaround.js"></script>
<!-- slider control: http://www.eyecon.ro/bootstrap-slider/ -->
<script src="js/bootstrap-slider.js"></script>

<script>
var volume = 5;
var mute = 0;

$(function ()
{
  // next line has no effect, just gets the current state
  command("api/incvol", "vol", "0");

  $('#slider').slider({ min: 0, max: 20, value: volume, tooltip: 'hide' })
    .on('slide', function(ev)
    {
       if (volume == ev.value) return;
       volume = ev.value;
       command("api/setvol", "vol", ev.value);
    }
  );

  $("button").click(function ()
  {
    if (this.id === "stp")
    {
        playstation("stop", -1);
    }
    else if (this.id === "mute")
    {
        if (mute == 0)
        {
	  command("api/setvol", "vol", "0");
	  mute = 1;
	}
	else
	{
	  alert("unmute");
	  command("api/setvol", "vol", volume.toString());
	  mute = 0;
	}
    }
    else if (this.id==="dn")
    {
        if (--volume < 0) volume = 0;
        $('#slider').slider('setValue', volume);
        command("api/setvol", "vol", volume.toString(), "VOL DOWN");
    }
    else if (this.id==="up")
    {
        if (++volume > 20) volume = 20;
        $('#slider').slider('setValue', volume);
        command("api/setvol", "vol", volume.toString(), "VOL UP");
    }
    else if (this.id==="ply")
    {
        $("#ply").prop('disabled', true);
        setTimeout(function(){ $("#ply").prop('disabled', false); }, 1500);
        var station, idx;
        if ($("#manualstation").val() == "")
        {
          station = $("#stationlist").val();
          idx = $("#stationlist").prop('selectedIndex')+1;
        }
        else
        {
          station = $("#manualstation").val();
          idx=-1;
        }
        playstation(station, idx);
    }
  });
});

function playstation(station, hint)
{
    $.ajax({
        url: "api/stream",
        data: "streamurl="+encodeURI(station) + (hint ? "&idx="+hint : ""),
        method: "post",
    }).done(function(data)
    {
        resp = JSON.parse(data)
        volume = resp.volume;
        $('#slider').slider('setValue', volume);
        if (station === "stop")
        {
          $("#number").val(resp.status == "OK" ? "STOP" : "ERROR");
          setTimeout(function(){ $("#number").val(""); }, 1000);
        }
        else
        {
          $("#number").val(resp.status = "OK" ? "PLAYING" : "ERROR");
        }
    });
}

function command(path, commandName, val, hint)
{
    $.ajax({
        url: path,
        data: commandName + "=" + encodeURI(val) + (hint ? "&idx="+hint : ""),
        method: "post",
    }).done(function(data)
    {
        resp = JSON.parse(data)
        volume = resp.volume;
        $('#slider').slider('setValue', volume);

        station = resp.idx-1;
        if (station >= 0) {
          var playing = document.getElementById('stationlist')[station].text;
          $("#number").val(playing);
        }
    });
}
</script>

</body>
</html>
